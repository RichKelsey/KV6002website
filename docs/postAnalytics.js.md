# postAnalytics.js

``postAnalytics.js`` contains a class of static functions that deals with
participant post interaction metrics. It handles collection, local session
storage and interfaces with [db_analytics.php][db_analytics.php] to update or
upload analytics to the database. It looks as any posts elements generated by
[displayPosts.js][displayPosts.js].

### Depends on:
- [db_analytics.php][db_analytics.php] (to interface with the database.)
- [dom.js][dom.js] (to render any analytics/response text onto the page)

### See also:

- [displayPosts.js][displayPosts.js]


[db_analytics.php]: db_analytics.php.md
[dom.js]: dom.js.md
[displayPosts.js]: displayPosts.js.md

## Example usage

To load, then update and store post analytics at certain intervals:

```JavaScript
// Load post analytics from session storage.
Analytics.loadStatistics();
// Call Analytics.update() at an interval of 200ms
setInterval(function() {Analytics.update()}, 200);
// Save analytics to session storage every second
setInterval(function() {Analytics.storeStatistics()}, 1000);
```

To upload post analytics to the database:

```JavaScript
// Simply call this function anywhere, even on another page when you want to upload it.
Analytics.interfaceDB("upload");
```

It is required that you at least call ``Analytics.storeStatistics()`` once
before you upload to the database, as calling
``Analytics.interfaceDB("upload")`` reads from from the session storage.

---

## Analytics.isReady

```JavaScript
Analytics.isReady(): bool
```

This function returns whether or not the Analytics class is ready and has
fetched needed information from the database.

At the moment it is only useful for use with ``getGroup()``.

### Parameters

This function has no parameters.

### Return Values

This function returns a boolean representing whether or not analyttics is
ready.

## Analytics.update

```JavaScript
Analytics.update(): //no return
```

This function gets collects the post elements on the page, updates their states
(like buttons and comments) and attaches on-click callbacks, collects and
updates post statistics based on the location of the post elements and updates
inner HTML in a parent element with an ID of "responseText".

Ideally this function is called in a repeatedly in a loop/at an interval.

### Parameters

This function has no parameters.

### Return Values

This function doesn't return anything.

## Analytics.storeStatistics

```JavaScript
Analytics.storeStatistics(): //no return
```

A function to store the object containing post statistics as a JSON string in
the session storage.

### Parameters

This function has no parameters.

### Return Values

This function doesn't return anything.

## Analytics.loadStatistics

```JavaScript
Analytics.loadSatistics(): //no return
```

A function to load post analytics into the ``Analytics`` class.

### Parameters

This function has no parameters.

### Return Values

This function doesn't return anything.

## Analytics.getStatistics

```JavaScript
Analytics.getStatistics(): Object|null
```

This function returns an Object containing post analytics from the session
storage in key-value pairs, where the key is the post id, and the values are
the objects containing the fields:

- retentionTime: float
- maxTimeViewed: float
- timesViewed  : int 
- hasLiked     : bool
- comment      : string

There is also a field called state, but this is only used by the analytics
class during run time and should be null.

### Parameters

This function has no parameters.

### Return Values

This function returns an Object containing post analytics in key-value pairs,
or null if there nothing is found from the session storage.

## Analytics.getGroup

```JavaScript
Analytics.getGroup(): Object
```

This function returns a copy of the participant's runtime group state.

### Parameters

This function has no parameters.
### Return Values

This function returns an object which is a copy of an internal Analytics object
attribute.

## Analytics.deleteStatistics

```JavaScript
Analytics.deleteStatistics(): //no return
```

This function deletes post analytics stored in the session storage.

### Parameters

This function has no parameters.

### Return Values

This function doesn't return anything.

## Analytics.interfaceDB

```JavaScript
Analytics.interfaceDB(string action, Object data = null): //no return
```

This function is used to perform a database action, depending on the string
``action``. This function sends post requests to
[db_analytics.php][db_analytics.php], where the actions are defined.

If there is an element with the id "responseText", it will insert the response
as HTML within the element.

### Parameters

**action**
- action is a string defining the database action to be performed.

**data**
- data is an object containing additional data that might be needed

### Return Values

This function doesn't return anything.

## Notes

The functions ``like()`` and ``comment()`` are public functions that aren't
documented here, but are attached as on-click callbacks to the like and comment
buttons respectively to handle like and commenting functionality.
